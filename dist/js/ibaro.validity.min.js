"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),Validity=function(){function t(e){_classCallCheck(this,t);var i=this;i.element=document.querySelectorAll(e),i.validityCustom={cpf:{fn:function(t){var e,a,l,s=t.value,r=s.replace(/[^\d]+/g,"");if(11!==r.length||/(0{11}|1{11}|2{11}|3{11}|4{11}|5{11}|6{11}|7{11}|8{11}|9{11})/.test(r))return i.validityAddClass(t),!1;for(e=0,a=0;a<9;a++)e+=parseInt(r[a])*(10-a);if(l=11-e%11,10!==l&&11!==l||(l=0),l!==parseInt(r[9]))return i.validityAddClass(t),!1;for(e=0,a=0;a<10;a++)e+=parseInt(r[a])*(11-a);return l=11-e%11,10!==l&&11!==l||(l=0),l!==parseInt(r[10])?(i.validityAddClass(t),!1):(i.validityRemoveClass(t),!0)},msgError:"Número de CPF inválido"},cnpj:{fn:function(t){var e,a,l,s,r,d,n=t.value,o=n.replace(/[^\d]+/g,"");if(14!==o.length||/(0{14}|1{14}|2{14}|3{14}|4{14}|5{14}|6{14}|7{14}|8{14}|9{14})/.test(o))return i.validityAddClass(t),!1;for(e=o.length-2,a=o.substring(0,e),l=o.substring(e),s=0,r=e-7,d=e;d>=1;d--)s+=a[e-d]*r--,r<2&&(r=9);if((s%11<2?0:11-s%11)!=l[0])return i.validityAddClass(t),!1;for(e+=1,a=o.substring(0,e),s=0,r=e-7,d=e;d>=1;d--)s+=a[e-d]*r--,r<2&&(r=9);return(s%11<2?0:11-s%11)!=l[1]?(i.validityAddClass(t),!1):(i.validityRemoveClass(t),!0)},msgError:"Número de CNPJ inválido"},letters:{fn:function(t){/\d/.test(t.value)?i.validityAddClass(t):i.validityRemoveClass(t)},msgError:"Campo não pode conter números"}},this.init()}return _createClass(t,[{key:"init",value:function(){var t=this;t.element.forEach(function(e){e.querySelectorAll("input, textarea, select").forEach(function(e){t.attributes(e)}),e.addEventListener("submit",function(i){i.preventDefault(),t.validity(e)})})}},{key:"attributes",value:function(t){var e=["min","max"],i=["email","url","date","number","tel"];t.required&&(t.dataset.validityRequired="",t.removeAttribute("required")),t.accept&&t.setAttribute("data-validity-accept",t.accept),e.map(function(e){t[e]&&(e[0].toUpperCase(),e.slice(1),t.setAttribute("data-validity-"+e,t[e]),t.removeAttribute(e))}),i.map(function(e){t.type===e&&(t.dataset.validityType=e,t.type="text")})}},{key:"validityAddClass",value:function(t){t.classList.add("validity--input-failed")}},{key:"validityRemoveClass",value:function(t){t.classList.remove("validity--input-failed")}},{key:"validity",value:function(t){var e=this;t.querySelectorAll("input, textarea, select").forEach(function(t){var i=t.getAttribute("data-validity-type")||t.type,a="file"===t.type?t.value:t.value=t.value.trim(),l=[];if(e.validityRemoveClass(t),t.removeAttribute("data-validity-error"),t.hasAttribute("data-validity-required")&&""===a&&(e.validityAddClass(t),l.push("Campo Obrigatório")),i)switch(i){case"email":/^[a-zA-Z0-9.!#$%&’*+\/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(a)||(e.validityAddClass(t),l.push("E-mail Inválido"));break;case"url":/^[(f|ht)tp?s].+.\D$/.test(a)||(e.validityAddClass(t),l.push('URL inválida. Inicie a url com "http://"'));break;case"date":!/^\d{1,2}[-|\/]\d{1,2}[-|\/]\d{2,4}$/.test(a)&&a.length>0&&(e.validityAddClass(t),l.push("Data Inválida. Formato deve ser DD/MM/AAAA"));break;case"number":isNaN(a)&&(e.validityAddClass(t),l.push("Número Inválido"));break;case"tel":/^[\(|\d]+\d(\)|\) | )(\d{3,5}(|-| )\d{4,5})$/.test(a)||(e.validityAddClass(t),l.push("Telefone Inválido. Ex.: (99) 9999-99999"))}if(t.hasAttribute("data-validity-max")){var s=parseFloat(t.getAttribute("data-validity-max"));"file"===t.type&&t.files.length>0?Object.keys(t.files).map(function(i){s<t.files[i].size/1024&&(e.validityAddClass(t),l.push("Arquivo deve ter até "+s+" Kb"))}):s<parseFloat(a)&&(e.validityAddClass(t),l.push("Valor máximo até "+s))}if(t.hasAttribute("data-validity-min")){var r=parseFloat(t.getAttribute("data-validity-min"));"file"===t.type&&t.files.length>0?Object.keys(t.files).map(function(i){r>t.files[i].size/1024&&(e.validityAddClass(t),l.push("Arquivo deve ter no mínimo "+r+" Kb"))}):r>parseFloat(a)&&(e.validityAddClass(t),l.push("Valor mínimo de "+r))}if(t.hasAttribute("data-validity-custom"))try{var d=e.validityCustom[t.getAttribute("data-validity-custom")];d.fn(t),l.push(d.msgError)}catch(e){console.log("Create custom function: "+t.getAttribute("data-validity-custom")+" in validityCustom")}if(t.hasAttribute("data-validity-accept")&&t.files.length>0){var n=t.getAttribute("data-validity-accept").replace(/,/g,"|"),o=new RegExp("("+n+")$");Object.keys(t.files).map(function(){o.test(a)||(e.validityAddClass(t),l.push("Permitido apenas arquivos ("+n.replace(/\|/g,"&#44; ")+")"))})}e.setMensage(l,t)}),e.validityCheck(t)}},{key:"setMensage",value:function(t,e){e.classList.value.split(" ").includes("validity--input-failed")&&e.setAttribute("data-validity-error",t.join(","))}},{key:"validityCheck",value:function(t){var e=this;t.querySelector(".validity--input-failed")?(document.querySelectorAll(".validity--notice").forEach(function(t){t.remove()}),t.querySelectorAll(".validity--input-failed").forEach(function(t,e){var i=t.getBoundingClientRect(),a=i.top+2+window.scrollY,l="TEXTAREA"===t.tagName?19:i.height-4,s=i.right-l-2,r=t.getAttribute("data-validity-error").split(",");console.log(i),document.body.insertAdjacentHTML("beforeend",'<label class="validity--notice" style="left:'+s+"px; top:"+a+"px; width:"+l+"px; height:"+l+"px; line-height:"+l+'px;"></label>');var d=document.body.lastElementChild;d.insertAdjacentHTML("beforeend",'<input class="validity--alertinput" type="checkbox" /><div class="validity--alertbox"><div class="validity--alert"><ul class="validity--list"></ul></div></div>');var n=!0,o=!1,u=void 0;try{for(var c,v=r[Symbol.iterator]();!(n=(c=v.next()).done);n=!0){var y=c.value;d.querySelector(".validity--list").insertAdjacentHTML("beforeend",'<li class="validity--item">'+y+"</li>")}}catch(t){o=!0,u=t}finally{try{!n&&v.return&&v.return()}finally{if(o)throw u}}d.addEventListener("mouseover",function(t){var e=t.target;t.y<window.innerHeight/2&&e.classList.add("validity--notice-bottom")})})):e.send(t)}},{key:"send",value:function(t){var e=new FormData(t),i=new XMLHttpRequest,a=t.querySelector('[type="submit"], button:not([type])'),l=document.querySelector(".validity--status"),s=document.querySelector(".validity--message");i.open("POST",t.action,!0),i.addEventListener("loadstart",function(e){a.setAttribute("data-validity-button",a.textContent),a.disabled="disabled",a.textContent="Enviando...",null===l&&(t.insertAdjacentHTML("beforeend",'<div class="validity--status"><div class="validity--message"></div><button type="button" class="validity--close"></button></div>'),l=document.querySelector(".validity--status"),s=document.querySelector(".validity--message"))}),i.addEventListener("loadend",function(t){a.textContent=a.getAttribute("data-validity-button"),a.removeAttribute("disabled"),l.classList.add("validity--status-complete");var e=document.querySelector(".validity--close"),i=setTimeout(function(){var t=new MouseEvent("click");e.dispatchEvent(t)},3e3);e.addEventListener("click",function(t){l.classList.add("validity--status-remove");var e=document.querySelector(".validity--status-remove"),a=window.getComputedStyle(e).animationDuration,s=1e3*parseFloat(a.replace("s",""));setTimeout(function(){l.remove(),clearTimeout(i)},s)})}),i.addEventListener("load",function(e){switch(a.textContent=a.getAttribute("data-validity-button"),a.removeAttribute("disabled"),i.status){case 200:l.classList.add("validity--status-ok"),s.textContent=t.dataset.validitySuccess||"Sua Mensagem foi enviada com sucesso!",t.querySelectorAll("input, select, textarea").forEach(function(t){t.value=""});break;case 404:l.classList.add("validity--status-error"),s.textContent="Form Action URI: 404 Error";case 500:l.classList.add("validity--status-error"),s.textContent="Form Action URI: 500 Error"}}),i.send(e)}}]),t}();